{% extends "todo_tasks/base.html" %}
{% load static %}
{% block title %}
    Главная страница
{% endblock %}

{% block content %}
    <br>
    <br>
    <form id="formAdd" method="POST" data-contracts-url="{% url 'ajax_load_contracts' %}"
          data-stages-url="{% url 'ajax_load_stages' %}">
        {% csrf_token %}
        {{ form.as_table }}
        <button type="submit" class="btn btn-success" href="/">
        </button>
    </form>

{% endblock %}

{% block js_stuff %}
    <!-- JS для работы таблицы со всеми заданиями -->
    <script>
        // после загрузки страницы
        $(function () {
            // инициализации подсказок для всех элементов на странице, имеющих атрибут data-toggle="tooltip"
            $('[data-toggle="tooltip"]').tooltip();
        });


        $("#id_task_object").change(function () {
            var url = $("#formAdd").attr("data-contracts-url");
            var objectId = $(this).val();  // получаем object ID из HTML input

            $.ajax({                       // формируем AJAX запрос
                url: url,                    // подгружаем URL адрес для запроса
                data: {
                    'object': objectId       // добавляем objectID в query параметры GET запроса
                },
                success: function (data) {   // `data` результат выполнения  функции `load_contract`
                    $("#id_task_contract").html(data);  // помещаем результат в выпадающее меню
                }
            });

        });
        //!JS для фильтрации списка этапов
        $("#id_task_contract").change(function () {
            var url = $("#formAdd").attr("data-stages-url");
            var conractId = $(this).val();

            $.ajax({
                url: url,
                data: {
                    'contract': conractId
                },
                success: function (data) {
                    $("#id_task_stage").html(data);
                }
            });

        });
    </script>
{% endblock %}